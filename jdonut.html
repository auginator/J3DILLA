<html>
    <head>
        <title>F.A.T | J3Dilla | auginator fork</title>
        <style>canvas { width: 100%; height: 100% }</style>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" href="styles/styles.css">
    </head>
    <body>
    	<script type="text/javascript" src="js/jquery-1.8.2.js"></script>
        <script type="text/javascript" src="js/three.js"></script>
		<script type="text/javascript" src="js/loaders/STLLoader.js"></script>
		<script type="text/javascript" src="js/Detector.js"></script>
		<script type="text/javascript" src="js/Stats.js"></script>

        <script> 
        	
        	var mouseX = 0, mouseY = 0;

        	/* Configure colors here */
        	var directionlLightColor = 0xE7635E;
        	var ambientLightColor = 0x00928C;
        	var materialColor = 0xF8E9A8;
        	
        	var scene = new THREE.Scene();
        	var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

			var ambient = new THREE.AmbientLight( ambientLightColor );
			scene.add( ambient );

			var directionalLight = new THREE.DirectionalLight( directionlLightColor );
				directionalLight.position.set( 0, 0, 1 ).normalize();

			scene.add( directionalLight );

        	var renderer = new THREE.WebGLRenderer();
        		renderer.setSize(window.innerWidth, window.innerHeight);
        	
        	document.body.appendChild(renderer.domElement);
        	
        	//This will be the 3D model 
        	var object;

			var material = new THREE.MeshLambertMaterial({color: materialColor});
			
			var loader = new THREE.STLLoader();

			loader.addEventListener( 'load', function ( event ) {
				object = event.content;
				// Optionally apply some sort of material...
				if(material instanceof THREE.Material) {
					for ( var i = 0; i < object.children.length; i ++ ) {
					   object.children[ i ].material = material;
					   object.children[ i ].rotation.x = 5;
					}
				  }
				object.updateMatrix(); // Not sure if this is needed.
				stl = object;

				/* 
					Rewrite this to have an init method? 
				*/
				//init();
				/* 
					Other examples I have seen use an animate() method...
					maybe it is for animating 3D models. 
				*/
				//animate();
				scene.add( object );

				camera.lookAt(object.children[ 0 ]);

				// Start rendered, now that our STL had loaded and is ready to go. 
				render();
			} );
			loader.load( 'myModels/jdonut.stl');


        	//Set the camera distance
        	//TODO: Have this change depending on the object dimensions. 
        	camera.position.z = 200;

			//
			function onWindowResize() {
				//camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
				// windowHalfX = window.innerWidth / .5;
				// windowHalfY = window.innerHeight / .5;

				// camera.aspect = window.innerWidth / window.innerHeight;
				// camera.updateProjectionMatrix();

				// renderer.setSize( window.innerWidth, window.innerHeight );

			}
			function onDocumentMouseMove( event ) {
				// mouseX = ( event.clientX - windowHalfX ) / .50;
				// mouseY = ( event.clientY - windowHalfY ) / .50;
				// mouseZ = ( event.clientz - windowHalfZ ) / .50;
			}

			function returnKey(evt)
			{
				console.log(evt.keyCode);

				var evt  = (evt) ? evt : ((event) ? event : null);
				var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null);
			 
				if ((evt.keyCode == 13) && (node.type == "text")) 
				{
					switch(node.id)
					{
						case 'search':
							getProduct();
							$('search').select();
							break;
					}
				}
			}

			document.addEventListener( 'mousemove', onDocumentMouseMove, false );
			window.addEventListener( 'resize', onWindowResize, false );
			document.addEventListener( 'keypress', returnKey);

        	function render() { 
				object.children[ 0 ].rotation.z += 0.01;
        		requestAnimationFrame(render);
        		renderer.render(scene, camera);
        	}

        	//render();
        </script> 
        <div id="controlPanel">
        	<p><a href="index.html">Back to Index</a></a></p>
        	<p>Download  <a href="myModels/jdonut.stl">jdonut.stl</a></a></p>
        	<p><a href="runJ3Dilla.php">Regenerate</a></p>

        	<table align="center">
        		<tr>
        			<td>&nbsp;</td>
        			<td align="center"><a href="#" class="uiButton" id="upBtn">UP</a></td>
        			<td>&nbsp;</td>		
        		</tr>		
        		<tr>
        			<td align="center"><a href="#" class="uiButton" id="leftBtn">LEFT</a></td>
        			<td>&nbsp;</td>
        			<td align="center"><a href="#" class="uiButton" id="rightBtn">RIGHT</a></td>		
        		</tr>		
        		<tr>
        			<td>&nbsp;</td>
        			<td align="center"><a href="#" class="uiButton" id="downBtn">DOWN</a></td>
        			<td>&nbsp;</td>		
        		</tr>		
        	</table>

    	</div>
    </body>
</html>
